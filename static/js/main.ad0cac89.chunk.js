(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{258:function(e,t,a){e.exports=a(505)},263:function(e,t,a){},329:function(e,t){},331:function(e,t){},364:function(e,t){},365:function(e,t){},407:function(e,t){},408:function(e,t){},409:function(e,t){},417:function(e,t,a){e.exports=a.p+"static/media/dataset.649191b6.png"},505:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(10),l=a.n(i),c=(a(263),a(44)),o=a(45),s=a(58),d=a(56),u=a(59),m=a(78),h=a(66),f=a(254),p=a(506),g=a(509),v={background:"linear-gradient(180deg,#031d6a,#000e48)",height:"58px"},E={background:"linear-gradient(180deg,#031d6a,#000e48)",borderBottom:"none"},b={color:"white"},y=function(){return r.a.createElement(p.a.Header,{id:"layoutHeader",style:v},r.a.createElement(g.b,{fixed:"top",mode:"horizontal",style:E},r.a.createElement(g.b.Item,null,r.a.createElement(m.b,{to:"/enclaveML",style:Object(f.a)({},b,{fontSize:"1.2em",fontWeight:"bold"})},"enclaveML")),r.a.createElement(g.b.Item,null,r.a.createElement(m.b,{to:"/enclaveML/webcam",style:b},"Webcam Demo")),r.a.createElement(g.b.Item,null,r.a.createElement(m.b,{to:"/enclaveML/pattern_recognition",style:b},"Pattern Recognition Demo"))))},w=a(80),x=a(42),D=function(){return r.a.createElement(p.a.Content,{style:{marginTop:"50px"}},r.a.createElement(w.a,{type:"flex",justify:"start",align:"middle"},r.a.createElement(x.a,{span:12,offset:4},r.a.createElement("h1",null,"enclaveML"))),r.a.createElement(w.a,{type:"flex",justify:"start",align:"middle"},r.a.createElement(x.a,{span:12,offset:4},r.a.createElement("p",null,"enclaveML is an experimental framework for tokenized federated learning."),r.a.createElement("p",null,"It aims to accomplish the following goals:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Allow the training of many types of machine learning models without requiring the transmission of private client-side data"),r.a.createElement("li",null,"Track and tokenize the contributed delta from participating clients, facilitating a crypto-economic primitive around the decentralized training of machine learning models.")))))},S=a(253),k=a(20),j=a.n(k),O=a(38),C=a(507),I=a(511),L=a(124),T=a(9),M=28,P=28,A=M*P,R=55e3,F=65e3-R,B=function(){function e(){Object(c.a)(this,e),this.shuffledTrainIndex=0,this.shuffledTestIndex=0}return Object(o.a)(e,[{key:"load",value:function(){var e=Object(O.a)(j.a.mark(function e(){var t,a,n,r,i,l,c,o,s=this;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Image,a=document.createElement("canvas"),n=a.getContext("2d"),r=new Promise(function(e,r){t.crossOrigin="",t.onload=function(){t.width=t.naturalWidth,t.height=t.naturalHeight;var r=new ArrayBuffer(65e3*A*4);a.width=t.width,a.height=5e3;for(var i=0;i<13;i++){var l=new Float32Array(r,i*A*5e3*4,5e3*A);n.drawImage(t,0,5e3*i,t.width,5e3,0,0,t.width,5e3);for(var c=n.getImageData(0,0,a.width,a.height),o=0;o<c.data.length/4;o++)l[o]=c.data[4*o]/255}s.datasetImages=new Float32Array(r),e()},t.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"}),i=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),e.next=7,Promise.all([r,i]);case 7:return l=e.sent,c=Object(L.a)(l,2),c[0],o=c[1],e.t0=Uint8Array,e.next=14,o.arrayBuffer();case 14:e.t1=e.sent,this.datasetLabels=new e.t0(e.t1),this.trainIndices=T.util.createShuffledIndices(R),this.testIndices=T.util.createShuffledIndices(F),this.trainImages=this.datasetImages.slice(0,A*R),this.testImages=this.datasetImages.slice(A*R),this.trainLabels=this.datasetLabels.slice(0,10*R),this.testLabels=this.datasetLabels.slice(10*R);case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTrainData",value:function(){return{xs:T.tensor4d(this.trainImages,[this.trainImages.length/A,M,P,1]),labels:T.tensor2d(this.trainLabels,[this.trainLabels.length/10,10])}}},{key:"getTestData",value:function(e){var t=T.tensor4d(this.testImages,[this.testImages.length/A,M,P,1]),a=T.tensor2d(this.testLabels,[this.testLabels.length/10,10]);return null!=e&&(t=t.slice([0,0,0,0],[e,M,P,1]),a=a.slice([0,0],[e,10])),{xs:t,labels:a}}}]),e}();function W(){var e=T.sequential();e.add(T.layers.flatten({inputShape:[M,P,1]})),e.add(T.layers.dense({units:42,activation:"relu"})),e.add(T.layers.dense({units:10,activation:"softmax"}));var t=T.train.adam();return e.compile({optimizer:t,loss:"categoricalCrossentropy",metrics:["accuracy"]}),e}var z=a(255),V=a(245),_=a.n(V),N=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(s.a)(this,Object(d.a)(t).call(this,e))).chart=null,a.id="chart"+Math.random(),a.updateStep=e.updateStep||10,a}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.trainData,n=t.valData;e.trainData!==a&&a.length%this.updateStep===0&&this.chart.series[0].update({data:a}),e.valData!==n&&this.chart.series[1].update({data:n})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.trainData,a=e.valData,n=e.yTitle,r={chart:{type:"line",height:250},credits:{enabled:!1},title:{text:""},xAxis:{enabled:!0,title:{text:e.xTitle||"batch"}},yAxis:{title:{text:n},minPadding:0,maxPadding:0},legend:{enabled:!!a},exporting:{enabled:!1},plotOptions:{series:{lineWidth:1,marker:{enabled:!1}}},series:[{id:"train",name:"Prediction",data:t},!!a&&{id:"val",name:"Validation",data:a}].filter(Boolean)};this.chart=new _.a.chart(this.id,r)}},{key:"componentWillUnmount",value:function(){this.chart.destroy()}},{key:"render",value:function(){return r.a.createElement(w.a,null,r.a.createElement(C.a,null,r.a.createElement("b",null,this.props.title)),r.a.createElement(C.a,{style:{padding:0}},r.a.createElement("div",{id:this.id})))}}]),t}(r.a.Component),H=a(510),q=(a(417),a(508)),U=function(e){return r.a.createElement(q.a,null,e.datasetLoading&&r.a.createElement("div",null,"Loading..."),!e.datasetLoading&&!e.training&&r.a.createElement(I.a,{labelPosition:"right",onClick:e.train},"Start Training"),e.trainingStatus&&r.a.createElement(q.a.Item,{style:{alignSelf:"flex-end",marginBottom:2}},e.trainingStatus))},J=function(e){return r.a.createElement("div",{style:{paddingBottom:20}},r.a.createElement(H.a,{defaultActiveKey:["1"],accordian:!0},r.a.createElement(H.a.Panel,{header:"Pattern Recognition Demo",key:"1"},r.a.createElement("p",null,"This proof-of-concept demonstrates federated learning on a pattern recognition model using handwritten numerical images stored on the client."),r.a.createElement("p",null,"More info ",r.a.createElement("a",{href:"http://yann.lecun.com/exdb/mnist/",target:"_blank",rel:"noopener noreferrer"},"More info on NIST"),"."),r.a.createElement(U,{dataLoading:e.dataLoading,loadData:e.loadData,train:e.train,training:e.training,trainingStatus:e.trainingStatus}))))},K=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(s.a)(this,Object(d.a)(t).call(this))).componentDidMount=Object(O.a)(j.a.mark(function t(){return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.state.datasetLoaded||e.loadData();case 1:case"end":return t.stop()}},t)})),e.loadData=Object(O.a)(j.a.mark(function t(){return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({dataLoading:!0}),e.data=new B,t.next=4,e.data.load();case 4:e.setState({dataLoaded:!0,dataLoading:!1});case 5:case"end":return t.stop()}},t)})),e.train=Object(O.a)(j.a.mark(function t(){var a,n,r,i,l;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({training:!0,trainingStatus:"Training model..."}),e.model=W(),550,.15,3,a=e.data.getTrainData(),n=e.data.getTestData(),r=3*Math.ceil(.85*R/550),t.next=10,e.model.fit(a.xs,a.labels,{batchSize:550,validationSplit:.15,epochs:3,callbacks:{onBatchEnd:function(){var t=Object(O.a)(j.a.mark(function t(a,n){var i;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.state.clients||0,e.setState({status:"Training... (".concat(((i+1)/r*100).toFixed(1),"% complete)"),clients:i+1,errorData:e.state.errorData.concat(n.loss),accData:e.state.accData.concat(n.acc)}),t.next=4,T.nextFrame();case 4:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}(),onEpochEnd:function(){var t=Object(O.a)(j.a.mark(function t(a,n){return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({errorValData:e.state.errorValData.concat([[e.state.clients,n.val_loss]]),currentEpoch:e.state.currentEpoch+1,accValData:e.state.accValData.concat([[e.state.clients,n.val_acc]])}),t.next=3,T.nextFrame();case 3:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}});case 10:i=e.model.evaluate(n.xs,n.labels),l=100*i[1].dataSync()[0],e.setState({trained:!0,status:"Final test accuracy: ".concat(l.toFixed(1),"%")});case 13:case"end":return t.stop()}},t)})),e.getImageData=function(){var t=e.predCanvas.current.getContext("2d");t.clearRect(0,0,P,M),t.drawImage(e.drawCanvas.canvas.drawing,0,0,P,M);var a=t.getImageData(0,0,P,M),n=T.browser.fromPixels(a,1);return n=n.reshape([1,28,28,1]),(n=T.cast(n,"float32")).div(T.scalar(255))},e.predict=Object(O.a)(j.a.mark(function t(){return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.tidy(function(){var t=e.getImageData(),a=e.model.predict(t).dataSync(),n=Array.from(a),r=n.indexOf(Math.max.apply(Math,Object(S.a)(n))),i=100*n[r];console.log(n),console.log(r),console.log(i),e.setState({prediction:r,predictionScore:i.toFixed(1)})});case 2:case"end":return t.stop()}},t)})),e.clearCanvas=function(){e.drawCanvas.clear(),e.predCanvas.current.getContext("2d").clearRect(0,0,P,M),e.setState({prediction:null,predictionScore:null})},e.state={dataLoaded:!1,dataLoading:!0,training:!1,trained:!1,trainingStatus:null,errorData:[],errorValData:[],accData:[],accValData:[],prediction:null,predictionScore:null,clients:0,currentEpoch:0},e.predCanvas=r.a.createRef(),e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.errorData,n=t.accData,i=t.prediction,l=t.trained,c=t.training,o=(t.status,t.dataLoading),s=r.a.createElement(w.a,null,this.state.clients>0&&r.a.createElement(w.a,null,r.a.createElement("h4",null,"Federated Clients: ",this.state.clients)," "),a.length>0&&r.a.createElement(x.a,null,r.a.createElement(N,{title:"Prediction Error",trainData:a,valData:this.state.errorValData,yTitle:"error"})),n.length>0&&r.a.createElement(x.a,null,r.a.createElement(N,{title:"Prediction Accuracy",trainData:n,valData:this.state.accValData,yTitle:"accuracy"}))),d=l&&r.a.createElement(w.a,null,r.a.createElement(x.a,null,r.a.createElement(C.a,null,r.a.createElement("span",{style:{display:"inline",float:"right",verticalAlign:"top"}},r.a.createElement(I.a,{compact:!0,content:"Clear",onClick:this.clearCanvas,size:"small"}),r.a.createElement(I.a,{compact:!0,positive:!0,content:"Predict",onClick:this.predict,size:"small"}))),r.a.createElement(C.a,{style:{padding:0}},r.a.createElement(z.a,{ref:function(t){return e.drawCanvas=t},lazyRadius:0,brushRadius:40,canvasWidth:"100%",canvasHeight:540}))),r.a.createElement(x.a,null,r.a.createElement(C.a,null,r.a.createElement("b",null,"Prediction")),r.a.createElement(C.a,{style:{height:540}},r.a.createElement(C.a,{type:"inner"},r.a.createElement(p.a.Content,{verticalAlign:"top"},r.a.createElement("div",{className:"item-header"},null!==i?"Neural network input (28 x 28 pixels):":"Draw any number and press 'Predict'."),r.a.createElement("canvas",{ref:this.predCanvas,width:28,height:28}))),null!==i&&r.a.createElement(C.a,{type:"inner"},r.a.createElement(p.a.Content,{verticalAlign:"middle"},r.a.createElement("div",{className:"item-header"},"Prediction: ",i))),null!==i&&r.a.createElement(C.a,{type:"inner"},r.a.createElement(p.a.Content,{verticalAlign:"middle"},r.a.createElement("div",{className:"item-header"},"Prediction accuracy: ",this.state.predictionScore,"%"))))));return r.a.createElement(p.a.Content,{style:{padding:"5em 0em"}},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12,offset:4},r.a.createElement(J,{trainingStatus:s,trainingResults:d,dataLoading:o,loadData:this.loadData,train:this.train,training:c}))))}}]),t}(r.a.Component),$=a(251),G=a.n($),Q=a(252),X="#031d6a",Y="#ffffff",Z=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(s.a)(this,Object(d.a)(t).call(this))).loadModel=Object(O.a)(j.a.mark(function t(){return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("loading"),e.setState({loading:!0}),e.addClient(),t.next=5,Q.a();case 5:e.model=t.sent;case 6:case"end":return t.stop()}},t)})),e.detectFrame=function(){if(!e.cam)return console.log("webcam not available"),null;e.model.detect(e.cam.video).then(function(t){e.renderPredictions(t),requestAnimationFrame(function(){return e.detectFrame()})})},e.renderPredictions=function(t){if(!e.cam)return console.log("webcam not available"),null;var a=e.canvasRef.current.getContext("2d");a.clearRect(0,0,a.canvas.width,a.canvas.height),a.font="16px sans-serif",a.textBaseline="top",t.forEach(function(e){var t=Object(L.a)(e.bbox,4),n=t[0],r=t[1],i=t[2],l=t[3];a.strokeStyle=X,a.lineWidth=4,a.strokeRect(n,r,i,l),a.fillStyle=X;var c=a.measureText(e.class).width;a.fillRect(n,r,c+4,20),a.fillStyle=Y,a.fillText(e.class,n,r)})},e.addClient=function(){e.setState({clients:e.state.clients+1}),e.state.clients>100?e.setState({loaded:!0,loading:!1},function(){return e.detectFrame()}):setTimeout(e.addClient,50)},e.onAccordionClick=function(t,a){var n=a.index,r=e.state.activeIndex;e.setState({activeIndex:r===n?-1:n})},e.state={loaded:!1,loading:!1,activeIndex:0,clients:0},e.cam=null,e.canvasRef=r.a.createRef(),e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.loaded,n=t.loading,i=(t.activeIndex,t.clients),l=r.a.createElement("div",{style:{paddingBottom:20}},r.a.createElement(H.a,{defaultActiveKey:["1"],accordian:!0},r.a.createElement(H.a.Panel,{header:"Webcam Object Detection",key:"1"},r.a.createElement("p",null,"This webcam demo simulates federated learning training of a Single Shot MultiBox Detection object recognition model."),a&&r.a.createElement(w.a,null,r.a.createElement(x.a,null,r.a.createElement(C.a,{style:{position:"relative",height:540,width:680,padding:8},raised:!0},r.a.createElement("canvas",{ref:this.canvasRef,style:{position:"absolute"},width:"640",height:"510"}),r.a.createElement(G.a,{ref:function(t){e.cam=t},audio:!1})))))));return r.a.createElement(p.a.Content,{style:{padding:"5em 0em"}},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12,offset:2},!a&&!n&&r.a.createElement(I.a,{onClick:this.loadModel},"Load Webcam Demo"),n&&r.a.createElement(w.a,null,r.a.createElement("h4",null,"Federated Clients: ",i)),a&&l)))}}]),t}(r.a.Component),ee=(a(504),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(s.a)(this,Object(d.a)(t).call(this,e))).state={loaded:!1},a}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(m.a,{basename:"/"},r.a.createElement("div",null,r.a.createElement(y,null),r.a.createElement("div",null,r.a.createElement(h.a,{path:"/enclaveML",component:D}),r.a.createElement(h.a,{path:"/enclaveML/pattern_recognition",component:K}),r.a.createElement(h.a,{path:"/enclaveML/webcam",component:Z}))))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(ee,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[258,1,2]]]);
//# sourceMappingURL=main.ad0cac89.chunk.js.map